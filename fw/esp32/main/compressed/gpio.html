<h1>GPIO C0ntr0l</h1> <fieldset> <legend>GPIO c0mm4nd&c0ntr0l</legend> <p>C0ntr0l 3xp0s3d p4ds</p> <div id="IOW"> </div> <div id="debug"> </div> </fieldset> <script type="text/javascript"> const SEND=(s,m)=>{s.send(JSON.stringify(m));};const SOCK = new WebSocket(`wss://${window.location.host}${window.location.pathname}ws`);SOCK.addEventListener('open',function (event){SEND(SOCK,{"api":"gpio","msg":"load"});});SOCK.addEventListener('message',function (event){$("debug").innerText = "";JSON.parse(event.data).states.forEach((item,i) =>{if($("check_gpio_d_"+item.id).checked == false ){$("check_gpio_s_"+item.id).checked = item.state?true:false;} });});SOCK.addEventListener('error',function (event){FN.SE();});SOCK.addEventListener('close',function (event){console.log('Disconnected from WebSocket server.');});let GPIOSTATE = (target)=>{let IO = б("[data-gpio='"+target.dataset.gpio+"']");let id = parseInt(target.dataset.gpio);IO[1].disabled = !(IO[0].checked);let mode = (IO[0].checked)?0:1;let state = (IO[1].checked)?1:0;let data ={id:id,state:state,mode:mode };console.log(data);fetch("./gpioconf",{method:"POST",body:"data=" + JSON.stringify(data) }) .then(e => e.text()) .then(e =>{console.log(e);});return data;};let DISP2 = ()=>{const table = _("table");let row = _("tr");let th = _("th");th.innerText="GPIO";子(row,th);for(let h=0;h<10;h++){th = _("th");th.innerText="["+(h+1)+"]";子(row,th);} 子(table,row);row = _("tr");th = _("th");th.innerText="D1r3ct10n";子(row,th);for(let d=1;d<=10;d++){let td = _("td");let div = _("div");let INP = _("input");INP.type="checkbox";INP.id="check_gpio_d_"+d;INP.dataset.gpio=d;INP.addEventListener("change",(e)=>{GPIOSTATE(e.target);});let ILBL = _("label");ILBL.htmlFor="check_gpio_d_"+d;ILBL.title="Click to togle direction";ILBL.classList.add("gpiolabel","gpiod");子(div,INP);子(div,ILBL);子(td,div);子(row,td);} 子(table,row);row = _("tr");th = _("th");th.innerText="St4t3";子(row,th);for(d=1;d<=10;d++){td = _("td");div = _("div");INP = _("input");INP.type="checkbox";INP.id="check_gpio_s_"+d;INP.dataset.gpio=d;INP.disabled = true;INP.addEventListener("change",(e)=>{GPIOSTATE(e.target);});ILBL = _("label");ILBL.htmlFor="check_gpio_s_"+d;ILBL.title="Click to togle state";ILBL.classList.add("gpiolabel","gpios");子(div,INP);子(div,ILBL);子(td,div);子(row,td);} 子(table,row);子($("IOW"),table);};window.addEventListener("beforeunload",(e) =>{SEND(SOCK,{"api":"gpio","msg":"unload"});});DISP2();FN.SS();</script> 